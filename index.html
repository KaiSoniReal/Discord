<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Start Audio - Extreme Workaround</title>
    <style>
        /* Fullscreen overlay for fallback */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            z-index: 9999;
        }

        body, html {
            margin: 0;
            padding: 0;
        }

        /* Hide iframe */
        iframe {
            display: none;
        }
    </style>
</head>
<body>

<!-- Overlay for manual fallback -->
<div id="overlay">
    ▶️ Click, tap, scroll, or press any key to start audio
</div>

<!-- Hidden iframe to create permissive autoplay context -->
<iframe id="audioIframe" allow="autoplay"></iframe>

<script>
    // Create a minimal HTML page for the iframe with the audio
    const iframe = document.getElementById('audioIframe');
    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
    iframeDoc.open();
    iframeDoc.write(`
        <audio id="primerAudio" muted>
            <source src="data:audio/mpeg;base64,/+MYxAAAAANIAAAAAExBTUUzLjEwMAAAAAAAAAAAAAD/4QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==" type="audio/mpeg">
        </audio>
        <audio id="mainAudio">
            <source src="Jewelxxt luagh.mp3" type="audio/mpeg">
        </audio>
        <script>
            const primerAudio = document.getElementById('primerAudio');
            const mainAudio = document.getElementById('mainAudio');
            let attempts = 0;
            const maxAttempts = 5;

            function playMainAudio() {
                mainAudio.play().then(() => {
                    window.parent.postMessage('audioSuccess', '*');
                }).catch(err => {
                    window.parent.postMessage('audioError: ' + err.message, '*');
                });
            }

            function tryAutoplay() {
                primerAudio.play().then(() => {
                    primerAudio.pause();
                    playMainAudio();
                }).catch(err => {
                    if (attempts < maxAttempts) {
                        attempts++;
                        setTimeout(tryAutoplay, 500);
                    } else {
                        window.parent.postMessage('primerError: ' + err.message, '*');
                    }
                });
            }

            window.addEventListener('load', tryAutoplay);
            document.addEventListener('DOMContentLoaded', tryAutoplay);
            document.addEventListener('click', playMainAudio, { once: true });
            document.addEventListener('touchstart', playMainAudio, { once: true });
        </script>
    `);
    iframeDoc.close();

    // Main page logic
    const overlay = document.getElementById('overlay');

    // Handle messages from iframe
    window.addEventListener('message', (event) => {
        console.log('Message from iframe:', event.data);
        if (event.data === 'audioSuccess') {
            overlay.style.display = 'none'; // Hide overlay on success
        } else if (event.data.startsWith('audioError') || event.data.startsWith('primerError')) {
            overlay.textContent = '⚠️ Autoplay blocked. Click, tap, scroll, or press a key.';
        }
    });

    // Simulate user interaction with synthetic events
    function simulateInteraction() {
        const events = [
            new MouseEvent('click', { bubbles: true }),
            new Event('touchstart', { bubbles: true }),
            new Event('scroll', { bubbles: true }),
            new KeyboardEvent('keydown', { bubbles: true, key: ' ' })
        ];
        events.forEach(event => {
            document.dispatchEvent(event);
            iframe.contentWindow.document.dispatchEvent(event);
            console.log('Simulated event:', event.type);
        });
    }

    // Trigger autoplay and simulate interaction
    window.addEventListener('load', () => {
        console.log('Page loaded, attempting autoplay');
        simulateInteraction();
    });

    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM content loaded, attempting autoplay');
        simulateInteraction();
    });

    // Fallback: Trigger on any user interaction
    const tryManualPlay = () => {
        iframe.contentWindow.postMessage('tryManualPlay', '*');
        document.removeEventListener('click', tryManualPlay);
        document.removeEventListener('touchstart', tryManualPlay);
        document.removeEventListener('scroll', tryManualPlay);
        document.removeEventListener('keydown', tryManualPlay);
    };

    document.addEventListener('click', tryManualPlay, { once: true });
    document.addEventListener('touchstart', tryManualPlay, { once: true });
    document.addEventListener('scroll', tryManualPlay, { once: true });
    document.addEventListener('keydown', tryManualPlay, { once: true });

    // Listen for manual play command from main page
    window.addEventListener('message', (event) => {
        if (event.data === 'tryManualPlay') {
            iframe.contentWindow.document.getElementById('mainAudio').play();
        }
    });
</script>

</body>
</html>
